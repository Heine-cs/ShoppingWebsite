@model List<OllieShop.ViewModels.VMGenerateOrdersByCartData> 

@{
    ViewData["Title"] = "商品運送與付款確認";
    Layout = "~/Views/Shared/_Layout_Customer.cshtml";
}
<style>
    #ProductInfoColumn {
        width: 200px;
    }

    .table{
        table-layout: fixed;
    }
</style>

<h1>@ViewData["Title"]</h1>

<table class="table align-middle">
    <thead class="table-light">
        <tr>
            <th>商品</th>
            <th>付款方式</th>
            <th>運送方式</th>
        </tr>
    </thead>
    <tbody>
        <form asp-controller="home" asp-action="processOrders" method="post">
            @Html.AntiForgeryToken()
            @for(int i=0;i <Model.Count();i++)
            {
                //填入Order資料表需要的資料
                <input class="form-control" type="hidden" asp-for="@Model[i].orders.OrderDate" />
                <input class="form-control" type="hidden" asp-for="@Model[i].orders.CRID" />
                <input class="form-control" type="hidden" asp-for="@Model[i].orders.ASID" />
                <input class="form-control" type="hidden" asp-for="@Model[i].orders.CNID" />
                <input class="form-control" type="hidden" asp-for="@Model[i].orders.SRID" />
                //填入OrderDetail資料表需要的資料
                <input class="form-control" type="hidden" asp-for="@Model[i].products.PTID" />
                <input class="form-control" type="hidden" asp-for="@Model[i].specifications.SNID" />
                <input class="form-control" type="hidden" asp-for="@Model[i].RequireQuantities" />

                
                <tr>
                    <td id="ProductInfoColumn" class="border-end">
                        <span class="h3">@Model[i].products.Name</span>
                        <img class="w-100 h-100" src="@Model[i].specifications.Picture" />
                    </td>
                    <td class="border-end">
                        @*一組表單元件
                        <div class="form-group">
                            <label></label>
                            <input class="form-control"/>
                        </div>
                        *@
@*                        <div class="sellerPaymentOptionsList form-group">
                            <select class="form-control" id="ordersRequireMaterial[@i].sellerPaymentMethodOptions" name="ordersRequireMaterial[@i].sellerPaymentMethodOptions">
                                    <option value="">請選擇付款方式</option>
                                    @foreach(SelectListItem sellerPaymentOption in @Model[i].sellerPaymentMethodOptions){
                                        <option value="@(sellerPaymentOption.Value)">@(sellerPaymentOption.Text)</option>
                                    }
                            </select>      
                        </div>
                        <div class="customerPaymentCardOptionsList d-none form-group">
                            <label>信用卡卡號</label>
                        <select class="form-control" id="ordersRequireMaterial[@i].customerPaymentCardOptions" name="ordersRequireMaterial[@i].customerPaymentCardOptions">
                                    <option value="">請選擇信用卡卡號</option>
                                    @foreach(SelectListItem customerPaymentCardOptions in @Model[i].customerPaymentCardOptions)
                                    {
                                        <option value="@(customerPaymentCardOptions.Value)">@(customerPaymentCardOptions.Text)</option>
                                    }
                            </select>
                        </div>*@
                    </td>
                    <td>
@*                        <div class="form-group">
                        <select class="form-control" id="ordersRequireMaterial[@i].sellerShipViaOptions" name="ordersRequireMaterial[@i].sellerShipViaOptions">
                                <option value="">請選擇運送方式</option>
                                @foreach(SelectListItem sellerShipViaOptions in @Model[i].sellerShipViaOptions)
                                {
                                    <option value="@(sellerShipViaOptions.Value)">@(sellerShipViaOptions.Text)</option>
                                }
                            </select>
                        </div>*@
                    </td>
                </tr>
            }
            <div class="form-group my-3">
                <input type="submit" value="完成訂單" class="btn btn-primary btn-lg" />
            </div>
        </form>
    </tbody>
</table>




@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        const customerPaymentCardOptions = $(".customerPaymentCardOptionsList .form-control");

        for(i=0; i < customerPaymentCardOptions.length;i++){
            console.log(customerPaymentCardOptions[i].childNodes);
            if(customerPaymentCardOptions[i].childNodes.length == 2){
                customerPaymentCardOptions[i].parentNode.classList.add("d-none");
            }
        }

        $(document).ready(function () {
            $('.sellerPaymentOptionsList .form-control').change(function () {
                var customerPaymentCardOptionsList = $(this).parent().next();
                if ($(this).val() === 'PM02') {
                    customerPaymentCardOptionsList.removeClass("d-none");
                    return "";
                }
                //選中後刷卡選項後又改回其他，就需要隱藏並清空
                customerPaymentCardOptionsList.addClass("d-none");
                customerPaymentCardOptionsList.children().eq(1).val("");

            });
        });
    </script>
}